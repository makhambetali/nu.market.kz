{% extends 'dist/main.html' %} {% block content %} {% load static %}

<style>
	input[type="range"]::-webkit-slider-thumb {
		pointer-events: all;
		width: 24px;
		height: 24px;
		-webkit-appearance: none;
		/* @apply w-6 h-6 appearance-none pointer-events-auto; */
	}
</style>
<div class="container mx-auto px-6 py-0">
	<div class="flex flex-col md:flex-row md:space-x-6">
		<!-- Filters Section -->
		<aside class="mb-8 w-full border-r md:mb-0 md:w-1/6">
			<div class="rounded-lg p-6">
				<h3 class="text-lg font-medium text-gray-700">Categories</h3>
				<ul class="mt-3 space-y-2">
					<li>
						<a href="#" class="text-gray-600 hover:text-gray-900"
							>Books</a
						>
					</li>
					<li>
						<a href="#" class="text-gray-600 hover:text-gray-900"
							>Electronics</a
						>
					</li>
					<li>
						<a href="#" class="text-gray-600 hover:text-gray-900"
							>Furniture</a
						>
					</li>
					<li>
						<a href="#" class="text-gray-600 hover:text-gray-900"
							>Clothing</a
						>
					</li>
					<li>
						<a href="#" class="text-gray-600 hover:text-gray-900"
							>Others</a
						>
					</li>
				</ul>
				<hr class="my-4" />

				<h3 class="text-lg font-medium text-gray-700">Condition</h3>
				<div class="mt-4 space-y-2">
					<label class="flex items-center">
						<input
							type="checkbox"
							class="form-checkbox text-blue-600"
						/>
						<span class="ml-2">New</span>
					</label>
					<label class="flex items-center">
						<input
							type="checkbox"
							class="form-checkbox text-blue-600"
						/>
						<span class="ml-2">Used</span>
					</label>
				</div>
				<hr class="my-4" />

				<h3 class="text-lg font-medium text-gray-700">Price Range</h3>
				<div class="mt-4 flex items-center justify-center">
					<div
						x-data="range()"
						x-init="mintrigger(); maxtrigger()"
						class="relative w-full max-w-xl"
					>
						<div>
							<input
								type="range"
								step="100"
								x-bind:min="min"
								x-bind:max="max"
								x-on:input="mintrigger"
								x-model="minprice"
								class="pointer-events-none absolute z-20 h-2 w-full cursor-pointer appearance-none opacity-0"
							/>

							<input
								type="range"
								step="100"
								x-bind:min="min"
								x-bind:max="max"
								x-on:input="maxtrigger"
								x-model="maxprice"
								class="pointer-events-none absolute z-20 h-2 w-full cursor-pointer appearance-none opacity-0"
							/>

							<div class="relative z-10 h-2">
								<div
									class="absolute bottom-0 left-0 right-0 top-0 z-10 rounded-md bg-gray-200"
								></div>

								<div
									class="absolute bottom-0 top-0 z-20 rounded-md bg-blue-300"
									x-bind:style="'right:'+maxthumb+'%; left:'+minthumb+'%'"
								></div>

								<div
									class="absolute left-0 top-0 z-30 -ml-0.5 -mt-1 h-4 w-4 rounded-full bg-blue-300"
									x-bind:style="'left: '+minthumb+'%'"
								></div>

								<div
									class="absolute right-0 top-0 z-30 -mr-0.5 -mt-1 h-4 w-4 rounded-full bg-blue-300"
									x-bind:style="'right: '+maxthumb+'%'"
								></div>
							</div>
						</div>

						<div class="flex items-center justify-between py-5">
							<div>
								<input
									type="text"
									maxlength="5"
									x-on:input="mintrigger"
									x-model="minprice"
									class="w-16 rounded border border-gray-200 px-2 text-center"
								/>
							</div>
							<div>
								<input
									type="text"
									maxlength="5"
									x-on:input="maxtrigger"
									x-model="maxprice"
									class="w-16 rounded border border-gray-200 px-2 text-center"
								/>
							</div>
						</div>
					</div>

					<script>
						function range() {
							return {
								minprice: 1000,
								maxprice: 7000,
								min: 100,
								max: 10000,
								minthumb: 0,
								maxthumb: 0,

								mintrigger() {
									this.minprice = Math.min(
										this.minprice,
										this.maxprice - 500
									);
									this.minthumb =
										((this.minprice - this.min) /
											(this.max - this.min)) *
										100;
								},

								maxtrigger() {
									this.maxprice = Math.max(
										this.maxprice,
										this.minprice + 500
									);
									this.maxthumb =
										100 -
										((this.maxprice - this.min) /
											(this.max - this.min)) *
											100;
								},
							};
						}
					</script>
				</div>

				<hr class="my-4" />
				<h3 class="text-lg font-medium text-gray-700">Location</h3>
				<div class="mt-4 space-y-2">
					<label class="flex items-center">
						<input
							type="checkbox"
							class="form-checkbox text-blue-600"
						/>
						<span class="ml-2">On Campus</span>
					</label>
					<label class="flex items-center">
						<input
							type="checkbox"
							class="form-checkbox text-blue-600"
						/>
						<span class="ml-2">Nearby</span>
					</label>
				</div>
			</div>
		</aside>

		<!-- Product Listings Section -->
		<div class="w-full md:w-3/4">
			<h2 class="my-4 text-xl font-semibold text-gray-800">
				Available Items
			</h2>
			<div class="grid grid-cols-1 gap-6 sm:grid-cols-2 lg:grid-cols-4 container-ajax">
				<!-- Product Card -->
				
				<!-- Repeat product cards as needed -->
				 
			</div>
		</div>
	</div>
</div>
<script>
    document.addEventListener('DOMContentLoaded', function() {
        // let offset = {{ posts|length }}; // Start with the number of posts already loaded
		let offset = 0
		let maxSize = "{{posts|length}}"
		console.log(maxSize)
		// alert(offset)
        const limit = 10; 
        const container = document.querySelector('.container-ajax');
        // const loadingIndicator = document.getElementById('loading');
        let loading = false;

        function loadMorePosts() {
            if (loading) return;
            loading = true;
            // loadingIndicator.style.display = 'block';

            if(offset < maxSize){
				fetch(`/load-posts/?offset=${offset}`)
                .then(response => response.json())
                .then(data => {
					console.log(data)
                    data.posts.forEach(post => {
							console.log(1)
                            const card = document.createElement('div');
                            card.className = 'overflow-hidden rounded-md bg-white shadow-md cursor-pointer relative';
                            card.innerHTML = `
                                <img src="${post.image_url}" alt="Product Image" class="h-48 w-full object-cover" />
                                <div class="p-5 pt-3.5">
                                    <div class="flex items-center justify-between gap-2">
                                        <a href="/details" class="flex h-12 cursor-pointer items-center text-gray-800 hover:underline">${post.title}</a>
                                        <label class="inline-flex cursor-pointer items-center">
                                            <input type="checkbox" value="" class="peer sr-only" unchecked />
                                            <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" class="size-6 peer-checked:fill-gray-800">
                                                <path stroke-linecap="round" stroke-linejoin="round" d="M21 8.25c0-2.485-2.099-4.5-4.688-4.5-1.935 0-3.597 1.126-4.312 2.733-.715-1.607-2.377-2.733-4.313-2.733C5.1 3.75 3 5.765 3 8.25c0 7.22 9 12 9 12s9-4.78 9-12Z"/>
                                            </svg>
                                        </label>
                                    </div>
                                    <p class="mb-4 mt-2 text-lg font-semibold text-gray-900 currency-text">${formatCurrency(post.price)}</p>
                                    <div class="flex justify-between text-sm text-gray-600">
                                        <span><span>${formatDate(post.created_at)}</span> ${post.created_time}</span>
                                        <span>Block ${post.block}</span>
                                    </div>
                                </div>
                            `;
                            container.appendChild(card);
                        });
                        offset += limit;
                    	loading = false;
                })
                .catch(error => {
                    console.error('Error loading posts:', error);
                    loading = false;
                });
        }

			}
        window.addEventListener('scroll', function() {
                if (window.innerHeight + window.scrollY >= document.body.offsetHeight - 50) {
                    loadMorePosts();
                }
            });

        loadMorePosts(); // Load initial posts
    });
</script>
<script>
	
	function formatCurrency(value) {
		return Intl.NumberFormat("de-DE", {
				style: "currency",
				currency: "KZT",
				maximumSignificantDigits: 10,
			}).format(value);
	}
	

</script>
<script>
	const today = new Date('{{today|date:"Y-m-d"}}').setHours(0, 0, 0, 0);
	const elements = document.querySelectorAll('.created_at');
	const formatDate = (date) => {
		const elemDate = new Date(date).setHours(0, 0, 0, 0);
		const dayDiff = (today - elemDate) / (1000 * 60 * 60 * 24);
		if (dayDiff === 0) {
			date = 'Сегодня в';
		} else if (dayDiff === 1) {
			date = 'Вчера в';
		} else if (dayDiff >= 2 && dayDiff <= 3) {
			date = `${Math.floor(dayDiff)} дня назад в`;
		} else {
			date = `${Math.floor(dayDiff)} дней назад в`;
		}
		return date
	}
</script>


{% endblock content %}
